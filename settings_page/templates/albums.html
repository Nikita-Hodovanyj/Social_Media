{% extends 'base.html' %}
{% load static %}

{% block title %}
   Альбоми
{% endblock %}

{% block link %}
<link rel="stylesheet" href="{% static 'css/albums.css' %}">
<link rel="stylesheet" href="{% static 'css/personal_info.css' %}">
{% endblock %}

{% block content %}
   <div class="main-wrapper">
      <aside>
            <div class = 'div-link-info2'>
                <a class = 'link-info2' href="{% url 'personal_info' %}">Особиста інформація</a>
            </div>
            <div class = 'div-link-albums2'>
               <a class ='link-albums2' href="{% url 'albums' %}">Альбоми</a>
            </div>
      </aside>
   
      <main>
           <div class="album-card">
               <div class = 'edit-profile'>
                   <p class="text-info2">Мої фото</p>
                   <div class="button-container">
                     <button class="edit-button">
                       <img src="{% static 'images/image-property.svg' %}" alt="">
                       Додати фото
                   </button>
                   </div>
               </div>
               <img class = 'profile-avatar' src="{% static 'images/avatar.png' %}" alt="">
               <!-- <div class="image-album-div">
                  <img class = 'eye-image1' src="{% static 'images/eye-property.svg' %}" alt="">
                  <img  class = 'trash-image1' src="{% static 'images/trash.svg' %}" alt="">
               </div> -->
            </div>
   
            <div class = 'edit-profile2'>
               <p class="text-info2">Немає ще жодного альбому</p>
               <div class="button-container">
                  <button class="edit-button1" onclick="toggleModal('create')">
                     <img src="{% static 'images/image-property.svg' %}" alt="">
                     Створити альбом
                  </button>
               </div>     
            </div>

            <div id="albumModal" class="modal modal-hidden">
               <div class="modal-content" style="position: relative;">
                 <img src="{% static 'images/-.png' %}" class="close-icon" onclick="toggleModal()" alt="Закрити">
                 <h2 id="modalTitle">Створити альбом</h2> <form id="albumForm" method="POST">
                   {% csrf_token %}
                   <input type="hidden" id="albumId" name="album_id" value=""> <div class="form-group-modal">
                     <label>Назва альбому</label>
                     <input type="text" id="albumName" name="album_name" required> </div>
             
                   <div class="form-group-modal">
                     <label>Оберіть тему</label>
                     <select id="albumTheme" name="album_theme" required> <option value="Природа">Природа</option>
                       <option value="Подорожі">Подорожі</option>
                       <option value="Сім'я">Сім'я</option>
                     </select>
                   </div>
             
                   <div class="form-group-modal">
                     <label>Рік альбому</label>
                     <select id="albumYear" name="album_year" required> {% for year in years %}
                       <option value="{{ year }}">{{ year }}</option>
                       {% endfor %}
                     </select>
                   </div>
             
                   <div class="modal-actions">
                     <button type="button" class="btn-modal-secondary" onclick="toggleModal()">Скасувати</button>
                     <button type="submit" class="btn-modal-primary">Зберегти</button>
                   </div>
                 </form>
               </div>
             </div>
             
             {% for album in albums %}
               <div class="album-card {% if album.is_hidden %}hidden-album{% endif %}">
                  <div class="buttons-album">
                     <h3>{{ album.name }}</h3>

                     <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="toggle_visibility" value="{{ album.id }}">
                        <button type="submit" class="icon-button">
                           <img src="{% static 'images/eye-property.svg' %}" alt="Сховати/показати">
                        </button>
                     </form>

                     <button class="icon-button edit-album-btn"
                          data-id="{{ album.id }}"
                          data-name="{{ album.name }}"
                          data-theme="{{ album.theme }}"
                          data-year="{{ album.year }}">
                        <img src="{% static 'images/:.png' %}" alt="Редагувати">
                      </button>

                  </div>
                  

                  <span>
                     <p class="theme-text">{{ album.theme }}</p>
                     <p class="year-text">{{ album.year }} рік</p>
                  </span>
                 

                   <p class="photo-text">Фотографії</p>

                   <div class="albums-images">

                     <form class="add-img-album">
                        <input type="file" id="image-input1" name="images-album" style="display: none;" multiple>
                    
                        <label сlass="label-album" for="image-input1" >
                              <img class="button-load-album" src="{% static 'images/add-plus.svg' %}" alt="Фото">
                        </label>
                        
                    
                     </form>

                   </div>

                  


                  <form method="post" style="display: inline;">
                     {% csrf_token %}
                     <input type="hidden" name="delete_album" value="{{ album.id }}">
                     
                  </form>

                 

                 
               </div>
             {% endfor %}
      </main>
   </div>
   
   <script>
      function toggleModal(action = '', albumData = null) {
         const modal = document.getElementById('albumModal');
         modal.classList.toggle('modal-hidden');
         
      
         const modalTitle = document.getElementById('modalTitle');
         const albumIdInput = document.getElementById('albumId');
         const albumNameInput = document.getElementById('albumName');
         const albumThemeSelect = document.getElementById('albumTheme');
         const albumYearSelect = document.getElementById('albumYear');

         if (action === 'create') {
            modalTitle.textContent = 'Створити альбом';
            albumIdInput.value = ''; 
            albumNameInput.value = '';
            albumThemeSelect.value = 'Природа'; 
            albumYearSelect.value = new Date().getFullYear(); 
         } else if (albumData) { 
            modalTitle.textContent = 'Редагувати альбом';
            albumIdInput.value = albumData.id;
            albumNameInput.value = albumData.name;
            albumThemeSelect.value = albumData.theme;
            albumYearSelect.value = albumData.year;
         } else { 
            
         }
      }
      
      
      document.querySelectorAll('.edit-album-btn').forEach(button => {
         button.addEventListener('click', function() {
            const albumData = {
               id: this.getAttribute('data-id'),
               name: this.getAttribute('data-name'),
               theme: this.getAttribute('data-theme'),
               year: this.getAttribute('data-year')
            };
            toggleModal('edit', albumData); 
         });
      });

      TRASH_IMAGE_SRC = "{% static 'image/trash.svg' %}"
      EYE_IMAGE_SRC = "{% static 'images/eye-property.svg' %}"
   </script>
   <script src="{% static 'js/album.js' %}"></script>
{% endblock %}